!function(){"use strict";function e(e,t=66){const n=function(e){const t=Uint8Array.from(Array.from(atob(e)).map(e=>e.charCodeAt(0)));return(new TextDecoder).decode(t)}(e);let r="";for(let o=0;o<n.length;o++)r+=String.fromCharCode(n.charCodeAt(o)^t);return r}document.addEventListener("DOMContentLoaded",function(){const t=window.QUIZ_DATA_LIST;if(!t)return;const n={studentId:"",name:"",answers:{},savedAt:""};document.querySelectorAll(".problem-container").forEach(r=>{const o=r.getAttribute("data-index");if(null===o)return;const c=parseInt(o,10),s=t[c],d=r.querySelector(".student-input"),a=r.querySelector(".check-btn"),l=r.querySelector(".result-msg");d&&a&&l&&a.addEventListener("click",()=>{const t=d.value.trim(),r=function(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return(t>>>0).toString(16)}(t),o=s.correctHashes.includes(r);if(o){const t=e(s.encryptedText);l.innerHTML=`<span style="color:blue">正解! (${t})</span>`,d.disabled=!0,a.disabled=!0}else l.innerHTML='<span style="color:red">不正解</span>';n.answers[c]={userAnswer:t,isCorrect:o,timestamp:(new Date).toISOString()}})});const r=document.getElementById("save-btn"),o=document.getElementById("student-id"),c=document.getElementById("student-name");r&&o&&c&&r.addEventListener("click",()=>{if(n.studentId=o.value,n.name=c.value,n.savedAt=(new Date).toISOString(),!n.studentId||!n.name)return void alert("学籍番号と氏名を入力してください");const e=JSON.stringify(n,null,2),t=new Blob([e],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=`${n.studentId}_${n.name}_progress.json`,r.click(),URL.revokeObjectURL(r.href)})})}();
